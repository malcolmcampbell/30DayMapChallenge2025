style = maptiler_style("basic"),
center = c(-79.383934, 43.65348) ,
zoom = 15.5,
pitch = 75,
bearing = 180
) |>
add_vector_source(
id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))
) |>
add_fill_extrusion_layer(
id = "3d-buildings",
source = 'openmaptiles',
source_layer = 'building',
fill_extrusion_color = interpolate(
column = 'render_height',
values = c(0, 250, 400),
stops = c('lightgray', 'dodgerblue', 'seagreen')
),
fill_extrusion_height = list(
'interpolate',
list('linear'),
list('zoom'),
15,
0,
16,
list('get', 'render_height')
)
)
###############################################################################
# CHRISTCHURCH
maplibre(
style = maptiler_style("basic"),
center = c(-79.383934, 43.65348) ,
zoom = 15.5,
pitch = 75,
bearing = 180
) |>
add_vector_source(
id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))
) |>
add_fill_extrusion_layer(
id = "3d-buildings",
source = 'openmaptiles',
source_layer = 'building',
fill_extrusion_color = interpolate(
column = 'render_height',
values = c(0, 200, 400),
stops = c('grey30', 'dodgerblue', 'seagreen')
),
fill_extrusion_height = list(
'interpolate',
list('linear'),
list('zoom'),
15,
0,
16,
list('get', 'render_height')
)
)
###############################################################################
# CHRISTCHURCH
maplibre(
style = maptiler_style("basic"),
center = c(-79.383934, 43.65348) ,
zoom = 15.5,
pitch = 75,
bearing = 180
) |>
add_vector_source(
id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))
) |>
add_fill_extrusion_layer(
id = "3d-buildings",
source = 'openmaptiles',
source_layer = 'building',
fill_extrusion_color = interpolate(
column = 'render_height',
values = c(0, 200, 400),
stops = c('gray30', 'dodgerblue', 'seagreen')
),
fill_extrusion_height = list(
'interpolate',
list('linear'),
list('zoom'),
15,
0,
16,
list('get', 'render_height')
)
)
###############################################################################
# CHRISTCHURCH
maplibre(
style = maptiler_style("basic"),
center = c(-79.383934, 43.65348) ,
zoom = 15.5,
pitch = 75,
bearing = 180
) |>
add_vector_source(
id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))
) |>
add_fill_extrusion_layer(
id = "3d-buildings",
source = 'openmaptiles',
source_layer = 'building',
fill_extrusion_color = interpolate(
column = 'render_height',
values = c(0, 200, 400),
stops = c('gray', 'dodgerblue', 'seagreen')
),
fill_extrusion_height = list(
'interpolate',
list('linear'),
list('zoom'),
15,
0,
16,
list('get', 'render_height')
)
)
###############################################################################
# CHRISTCHURCH
maplibre(
style = maptiler_style("basic"),
center = c(-79.383934, 43.65348) ,
zoom = 15.5,
pitch = 75,
bearing = 180
) |>
add_vector_source(
id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))
) |>
add_fill_extrusion_layer(
id = "3d-buildings",
source = 'openmaptiles',
source_layer = 'building',
fill_extrusion_color = interpolate(
column = 'render_height',
values = c(0, 200, 400),
stops = c('gray', 'dodgerblue', 'red')
),
fill_extrusion_height = list(
'interpolate',
list('linear'),
list('zoom'),
15,
0,
16,
list('get', 'render_height')
)
)
###############################################################################
# CHRISTCHURCH
maplibre(
style = maptiler_style("basic"),
center = c(-79.383934, 43.65348) ,
zoom = 15.5,
pitch = 75,
bearing = 180
) |>
add_vector_source(
id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))
) |>
add_fill_extrusion_layer(
id = "3d-buildings",
source = 'openmaptiles',
source_layer = 'building',
fill_extrusion_color = interpolate(
column = 'render_height',
values = c(0, 200, 400),
stops = c('gray', 'dodgerblue', 'blue')
),
fill_extrusion_height = list(
'interpolate',
list('linear'),
list('zoom'),
15,
0,
16,
list('get', 'render_height')
)
)
###############################################################################
# CHRISTCHURCH
maplibre(
style = maptiler_style("basic"),
center = c(-79.383934, 43.65348) ,
zoom = 15.5,
pitch = 75,
bearing = 180
) |>
add_vector_source(
id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))
) |>
add_fill_extrusion_layer(
id = "3d-buildings",
source = 'openmaptiles',
source_layer = 'building',
fill_extrusion_color = interpolate(
column = 'render_height',
values = c(0, 200, 400),
stops = c('gray', 'dodgerblue', 'dodgerblue2')
),
fill_extrusion_height = list(
'interpolate',
list('linear'),
list('zoom'),
15,
0,
16,
list('get', 'render_height')
)
)
###############################################################################
# CHRISTCHURCH
maplibre(
style = maptiler_style("basic"),
center = c(-79.383934, 43.65348) ,
zoom = 15.5,
pitch = 75,
bearing = 180
) |>
add_vector_source(
id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))
) |>
add_fill_extrusion_layer(
id = "3d-buildings",
source = 'openmaptiles',
source_layer = 'building',
fill_extrusion_color = interpolate(
column = 'render_height',
values = c(0, 200, 400),
stops = c('gray', 'dodgerblue', 'lightblue')
),
fill_extrusion_height = list(
'interpolate',
list('linear'),
list('zoom'),
15,
0,
16,
list('get', 'render_height')
)
)
###############################################################################
# CHRISTCHURCH
maplibre(
style = maptiler_style("basic"),
center = c(-79.383934, 43.65348) ,
zoom = 15.5,
pitch = 75,
bearing = 0
) |>
add_vector_source(
id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))
) |>
add_fill_extrusion_layer(
id = "3d-buildings",
source = 'openmaptiles',
source_layer = 'building',
fill_extrusion_color = interpolate(
column = 'render_height',
values = c(0, 200, 400),
stops = c('gray', 'dodgerblue', 'lightblue')
),
fill_extrusion_height = list(
'interpolate',
list('linear'),
list('zoom'),
15,
0,
16,
list('get', 'render_height')
)
)
###############################################################################
# LONDON
maplibre(style = maptiler_style("basic"),center = c(CitiesDF [3,3], CitiesDF [3,2]),
zoom = 15.5,   pitch = 75,   bearing = 180) |>
add_vector_source(id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))  ) |>
add_fill_extrusion_layer(    id = "3d-buildings",
source = 'openmaptiles',    source_layer = 'building',    fill_extrusion_color = interpolate(
column = 'render_height',      values = c(0, 200, 400),   stops = c('blue', 'dodgerblue', 'lightblue')
),
fill_extrusion_height = list(      'interpolate',      list('linear'),      list('zoom'),      15,
0,      16,      list('get', 'render_height')    )  )
###############################################################################
# LONDON
maplibre(style = maptiler_style("basic"),center = c(CitiesDF [3,3], CitiesDF [3,2]),
zoom = 15.5,   pitch = 75,   bearing = 180) |>
add_vector_source(id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))  ) |>
add_fill_extrusion_layer(    id = "3d-buildings",
source = 'openmaptiles',    source_layer = 'building',    fill_extrusion_color = interpolate(
column = 'render_height',      values = c(0, 200, 400),   stops = c('lightblue', 'dodgerblue', 'blue')
),
fill_extrusion_height = list(      'interpolate',      list('linear'),      list('zoom'),      15,
0,      16,      list('get', 'render_height')    )  )
###############################################################################
# LONDON
maplibre(style = maptiler_style("basic"),center = c(CitiesDF [1,3], CitiesDF [1,2]),
zoom = 15.5,   pitch = 75,   bearing = 180) |>
add_vector_source(id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))  ) |>
add_fill_extrusion_layer(    id = "3d-buildings",
source = 'openmaptiles',    source_layer = 'building',    fill_extrusion_color = interpolate(
column = 'render_height',      values = c(0, 200, 400),   stops = c('lightblue', 'dodgerblue', 'blue')
),
fill_extrusion_height = list(      'interpolate',      list('linear'),      list('zoom'),      15,
0,      16,      list('get', 'render_height')    )  )
###############################################################################
# LONDON
maplibre(style = maptiler_style("basic"),center = c(CitiesDF [2,3], CitiesDF [2,2]),
zoom = 15.5,   pitch = 75,   bearing = 180) |>
add_vector_source(id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))  ) |>
add_fill_extrusion_layer(    id = "3d-buildings",
source = 'openmaptiles',    source_layer = 'building',    fill_extrusion_color = interpolate(
column = 'render_height',      values = c(0, 200, 400),   stops = c('lightblue', 'dodgerblue', 'blue')
),
fill_extrusion_height = list(      'interpolate',      list('linear'),      list('zoom'),      15,
0,      16,      list('get', 'render_height')    )  )
##############################################################################
# CHOOSE YOUR OWN ADVENTURE
Cities <- c("London, United Kingdom",
"Dublin, Ireland",
"Belfast, United Kingdom",
# add your own place there with city and counyry?
"Toronto, Canada")
###############################################################################
# LONDON
maplibre(style = maptiler_style("basic"),center = c(CitiesDF [3,3], CitiesDF [3,2]),
zoom = 15.5,   pitch = 75,   bearing = 180) |>
add_vector_source(id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))  ) |>
add_fill_extrusion_layer(    id = "3d-buildings",
source = 'openmaptiles',    source_layer = 'building',    fill_extrusion_color = interpolate(
column = 'render_height',      values = c(0, 200, 400),   stops = c('lightblue', 'dodgerblue', 'blue')
),
fill_extrusion_height = list(      'interpolate',      list('linear'),      list('zoom'),      15,
0,      16,      list('get', 'render_height')    )  )
##############################################################################
# CHOOSE YOUR OWN ADVENTURE
Cities <- c("London, United Kingdom",
"Dublin, Ireland",
"Belfast, United Kingdom",
# add your own place there with city and counyry?
"Toronto, Canada")
CitiesDF <- geocode_OSM(Cities)
CitiesDF
###############################################################################
# LONDON
maplibre(style = maptiler_style("basic"),center = c(CitiesDF [3,3], CitiesDF [3,2]),
zoom = 15.5,   pitch = 75,   bearing = 180) |>
add_vector_source(id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))  ) |>
add_fill_extrusion_layer(    id = "3d-buildings",
source = 'openmaptiles',    source_layer = 'building',    fill_extrusion_color = interpolate(
column = 'render_height',      values = c(0, 200, 400),   stops = c('lightblue', 'dodgerblue', 'blue')
),
fill_extrusion_height = list(      'interpolate',      list('linear'),      list('zoom'),      15,
0,      16,      list('get', 'render_height')    )  )
###############################################################################
# CHRISTCHURCH
maplibre(
style = maptiler_style("basic"),
center = c(-79.383934, 43.65348) ,
zoom = 15.5,
pitch = 75,
bearing = 0
) |>
add_vector_source(
id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))
) |>
add_fill_extrusion_layer(
id = "3d-buildings",
source = 'openmaptiles',
source_layer = 'building',
fill_extrusion_color = interpolate(
column = 'render_height',
values = c(0, 200, 400),
stops = c('gray', 'dodgerblue', 'lightblue')
),
fill_extrusion_height = list(
'interpolate',
list('linear'),
list('zoom'),
15,
0,
16,
list('get', 'render_height')
)
)
###############################################################################
# LONDON
maplibre(style = maptiler_style("basic"),center = c(CitiesDF [3,3], CitiesDF [3,2]),
zoom = 15.5,   pitch = 75,   bearing = 180) |>
add_vector_source(id = "openmaptiles",
url = paste0("https://api.maptiler.com/tiles/v3/tiles.json?key=",
Sys.getenv("MAPTILER_API_KEY"))  ) |>
add_fill_extrusion_layer(    id = "3d-buildings",
source = 'openmaptiles',    source_layer = 'building',    fill_extrusion_color = interpolate(
column = 'render_height',      values = c(0, 200, 400),   stops = c('lightblue', 'dodgerblue', 'blue')
),
fill_extrusion_height = list(      'interpolate',      list('linear'),      list('zoom'),      15,
0,      16,      list('get', 'render_height')    )  )
rm(list=ls())
# creating an affordability MEASURE
# using Labour Cost Index to increase wages
# to inflate CENSUS2023 data
# source: https://www.stats.govt.nz/information-releases/labour-market-statistics-march-2024-quarter/#:~:text=In%20the%20year%20to%20the%20March%202024,ordinary%20time%20hourly%20earnings%20increased%20to%20$40.96.
# 2024Q1 up 4.1 percent = 1.04
# source: https://www.stats.govt.nz/information-releases/labour-market-statistics-march-2025-quarter/#:~:text=all%20salary%20and%20wage%20rates%20(including%20overtime),hourly%20earnings%20increased%20to%20$42.79%20from%20$40.96.
# Year to the March 2025 Q: salary & wage rates (incl OT) increased 2.9 percent = 1.029
# 2023 Median household Income: $97,000
# variety of measures HERE
# https://www.hud.govt.nz/stats-and-insights/change-in-housing-affordability-indicators/other-ways-to-measure-housing-affordability#tabset
pacman::p_load(sf, tmap, tidyverse)
#read in GEOPAKCAGE with DATA - SLIMMED precreated version
SA2_HH_2023_income <- st_read(".data//SA2_HH_2023_income_CHCH.gpkg")
#read in GEOPAKCAGE with DATA - SLIMMED precreated version
SA2_HH_2023_income <- st_read(".data/SA2_HH_2023_income_CHCH.gpkg")
#read in GEOPAKCAGE with DATA - SLIMMED precreated version
SA2_HH_2023_income <- st_read("./data/SA2_HH_2023_income_CHCH.gpkg")
# clipping, removing 0 sized geographies
SA2_HH_2023_income <- SA2_HH_2023_income |>
# getting rid of coastal and inlets (if desired)
filter(LAND_AREA_SQ_KM>0) |>
filter(AREA_SQ_KM>0) |>
filter(Shape_Length>0)
# map it!
tm_shape(SA2_HH_2023_income) + tm_polygons()
# what variables are present?
names(SA2_HH_2023_income)
# clean up NAs
SA2_HH_2023_income <- SA2_HH_2023_income %>%
mutate(
across(HHtotal:MedianWeeklyRent,
~case_when(. == -999 ~ NA,
. == -998 ~ NA,
. == -997 ~ NA,
. != -999 ~ .)))
SA2_HH_2023_income <- SA2_HH_2023_income |>
mutate ( MedianEstHHInc2024 =  MedianHHInc *1.04 ) |>
mutate ( MedianEstHHInc2025 =  MedianEstHHInc2024 * 1.029 ) |>
mutate ( MedianEstAffordability2025 = MedianEstHHInc2025 * 3 )|>
mutate ( NZEstHHMedian2025 = MedianEstHHInc2025 * 6 )
# Map it!
tmap_mode("plot")
#
HHAfford <-
tm_shape(SA2_HH_2023_income)+ tm_fill(fill="grey20", lwd=1.75, fill_alpha=0.25) +
tm_shape(GLA)+ tm_borders("black", lwd=3, fill_alpha=0.1) +
tm_shape(RAIL)+tm_lines(col="#773dbd", lwd=0.65) +
tm_title (text="") +
tm_credits(text ="Created by Malcolm Makes Maps \n Source: OSM © OpenStreetMap contributors",position = tm_pos_out("center", "bottom")) +
tm_scalebar(position = tm_pos_out("center", "bottom"))
#
HHAfford <-
tm_shape(SA2_HH_2023_income)+ tm_fill(fill=MedianEstAffordability2025, lwd=1.75, fill_alpha=0.25) +
tm_title (text="") +
tm_credits(text ="Created by Malcolm Makes Maps \n Source: OSM © OpenStreetMap contributors",position = tm_pos_out("center", "bottom")) +
tm_scalebar(position = tm_pos_out("center", "bottom"))
#
HHAfford <-
tm_shape(SA2_HH_2023_income)+ tm_fill(fill="MedianEstAffordability2025", lwd=1.75, fill_alpha=0.25) +
tm_title (text="") +
tm_credits(text ="Created by Malcolm Makes Maps \n Source: OSM © OpenStreetMap contributors",position = tm_pos_out("center", "bottom")) +
tm_scalebar(position = tm_pos_out("center", "bottom"))
HHAfford
#
HHAfford <-
tm_shape(SA2_HH_2023_income)+ tm_fill(fill="MedianEstAffordability2025", lwd=1.75, fill_alpha=0.25) +
tm_title (text="") +
tm_credits(text ="Created by Malcolm Makes Maps \n Source: Authors Calculations. NZ Census 2023. StatsNZ",position = tm_pos_out("center", "bottom")) +
tm_scalebar(position = tm_pos_out("center", "bottom"))
HHAfford
#
HHAfford <-
tm_shape(SA2_HH_2023_income)+ tm_fill(fill="MedianEstAffordability2025", lwd=1.75, fill_alpha=0.5) +
tm_title (text="") +
tm_credits(text ="Created by Malcolm Makes Maps \n Source: Authors Calculations. NZ Census 2023. StatsNZ",position = tm_pos_out("center", "bottom")) +
tm_scalebar(position = tm_pos_out("center", "bottom"))
HHAfford
